# 迭代任务

1. 走查画笔`LPen`，画刷`LBrush`、`LLinearGradient`，菜单`LMenu`、`LMenuItem`部分代码

# 代码走查问题

## 画笔

### LPen

1. `JointType`线段交点样式，目前是只有一种方式，后续还有更多方式引入吗？

   - 如果有引入，那么构造函数对应也需要进行改造，构造函数见第`2`点

   ~~~cpp
   /**
    * @enum JointType
    * @brief 线段交点样式定义，表示线段相交时，不同的连接方式。
    */
   enum JointType
   {
       FlatJoint = 0       ///< 直接连接，没有拐点修饰
   };
   ~~~

2. 构造函数注释少写`@param color`

   ```cpp
   /**
    * @brief 构造函数，设置画笔宽度。
    * @param width 画笔宽度
    */
   explicit LPen(int width = 1, const LColor &color = LColor()) : m_width(width), m_color(color) {}
   ```

3. 拷贝构造函数、`width()`接口的`@brief`没有句号

   ```cpp
   /**
   * @brief 拷贝构造函数
   * @param other 待拷贝对象
   */
   LPen(const LPen &other) : m_width(other.width()), m_jointType(other.jointType()), m_color(other.color()) {}
   
   ...
   
   /**
   * @brief 返回画笔宽度
   * @return 画笔宽度
   */
   int width() const { return m_width; }
   ```

4. `setColor()`接口参数传常量引用更好一点

   ```cpp
   /**
    * @brief 设置画笔颜色。
    * @param color 画笔颜色
    */
   void setColor(LColor color) { m_color = color; }
   ```

5. `m_width`注释错误

   ~~~cpp
   /**
    * @brief 画笔连接样式。
    */
   int m_width = 0;
   ~~~

## 画刷

### LBrush

1. 拷贝构造函数可以内联

   ```cpp
   LBrush::LBrush(const LBrush &other) :
       m_brushType(other.type()),
       m_color(other.color())
   {
       m_pGradient = new LLinearGradient(*(other.gradient()));
   }
   ```

2. `setBrushType`的`@param`的单词与参数不对应

   ```cpp
   /**
    * @brief 设置笔刷样式。
    * @param brushTypes 笔刷样式
    */
   void setBrushType(BrushType brushType);
   ```

3. `setGradient`的`@param`与参数不对应

   - 单词不对应，描述也不对应

   ```cpp
   /**
    * @brief 设置渐变色属性。
    * @param pGradient 渐变色类指针
    */
   void setGradient(const LLinearGradient &gradient);
   ```

4. 代码中`LLinearGradient`结构存放的是指针，内存放在堆区，个人认为完全没有必要

   - `LLinearGradient`的成员变量如下，存这些东西哪里需要放在堆区？
   - 这里更改之后，源文件中关于指针`new`和`delete`的东西都需要进行修改

   ~~~cpp
   class LLinearGradient
   {
   	...
           
   private:
       
       ...
           
   	/**
        * @brief 标识渐变起点坐标。
       */
       LPoint m_start;   
       /**
        * @brief 标识渐变终点坐标。
       */                   
       LPoint m_finalStop;
       /**
        * @brief 标识渐变铺展效果，默认为PadMode。
       */                   
       GradientMode m_mode = PadMode;
       /**
        * @brief 标识渐变点数组，包含渐变比例参数和颜色,渐变比例参数范围为[0,1]。
       */   
       LVector<LPair<double, LColor>> m_stops;
   };
   ~~~

### LLinearGradient

1. 头文件`<cmath>`的引入错误

   ```cpp
   #include "lpoint.h"
   #include "lcolor.h"
   #include "lvector.h"
   #include "lpair.h"
   #include "cmath"
   ```

2. `enum`的格式不正确，少了`@enum`，`{`应该提行

   ```cpp
   /**
    * @brief 铺展效果枚举。
   */
   enum GradientMode {
       PadMode,             ///<默认铺展效果，没有被渐变覆盖的区域填充单一的起始颜色或终止颜色
       RepeatMode           ///<渐变在起点与终点的渐变区域外重复
   };
   ```

3. 代码中有很多应该有空行，但没有空行的格式问题

   ```cpp
   #include "lpoint.h"
   #include "lcolor.h"
   #include "lvector.h"
   #include "lpair.h"
   #include "cmath"
   /**
    * @class LLinearGradient
    * @brief 渐变色填充类,与LBrush结合使用，以指定线形渐变笔刷。
    * @details 默认初始起点颜色为黑色，终点颜色为白色。
    */
   class LLinearGradient
   {
   
   public:
       /**
        * @brief 铺展效果枚举。
       */
       enum GradientMode {
           PadMode,             ///<默认铺展效果，没有被渐变覆盖的区域填充单一的起始颜色或终止颜色
           RepeatMode           ///<渐变在起点与终点的渐变区域外重复
       };
       /**
        * @brief 默认构造函数。
        */
       LLinearGradient();
   
       ...
       
       /**
        * @brief 标识渐变起点坐标。
       */
       LPoint m_start;   
       /**
        * @brief 标识渐变终点坐标。
       */                   
       LPoint m_finalStop;
       /**
        * @brief 标识渐变铺展效果，默认为PadMode。
       */                   
       GradientMode m_mode = PadMode;
       /**
        * @brief 标识渐变点数组，包含渐变比例参数和颜色,渐变比例参数范围为[0,1]。
       */   
       LVector<LPair<double, LColor>> m_stops;
   };
   ```

4. 代码中有很多内联函数，格式不正确

   ```cpp
   /**
    * @brief 设置渐变起点位置。
    * @param start 渐变起点坐标
    */
   void setStart(const LPoint &start)
   {
       m_start = start;
   }
   
   ...
   
   /**
    * @brief 设置渐变终点位置。
    * @param finalStop 渐变终点坐标
    */
   void setFinalStop(const LPoint &finalStop)
   {
       m_finalStop = finalStop;
   }
   
   ...
   
   /**
    * @brief 设置铺展效果。
    * @param mode 铺展效果
   */
   void setMode(GradientMode mode)
   {
       m_mode = mode;
   }
   
   ...
   
   /**
    * @brief 获取渐变起点。
    */
   LPoint start() const
   {
       return LPoint(m_start);
   }
   
   /**
    * @brief 获取渐变终点。
    */
   LPoint finalStop() const
   {
       return LPoint(m_finalStop);
   }
   
   /**
    * @brief 获取铺展效果。
   */
   GradientMode mode() const 
   { 
       return m_mode; 
   }
   
   /**
    * @brief 获取渐变颜色数组。
   */
   LVector<LPair<double, LColor>> stops() const 
   { 
       return m_stops; 
   }
   ```

5. 头文件中很多函数不能内联

   ```cpp
   /**
    * @brief 设置渐变起点位置。
    * @param x 渐变起点横坐标
    * @param y 渐变起点纵坐标
    */
   void setStart(int x, int y)
   {
       m_start.setX(x);
       m_start.setY(y);
   }
   
   ...
       
   /**
    * @brief 设置渐变终点位置。
    * @param x 渐变终点横坐标
    * @param y 渐变终点纵坐标
    */
   void setFinalStop(int x, int y)
   {
       m_finalStop.setX(x);
       m_finalStop.setY(y);
   }
   
   ...
   
   /**
    * @brief 设置渐变颜色数组。
    * @param stops 渐变颜色数组
   */
   void setStops(const LVector<LPair<double, LColor>> &stops)
   {
       m_stops = stops;
       if (m_stops.first().key() != 0)
       {
           m_stops.insert(0, LPair<double, LColor>(0, LColor(0,0,0)));
       }
       if (m_stops.last().key() != 1)
       {
           m_stops.append(LPair<double, LColor>(1, LColor(255,255,255)));
       }
   }
   ```

6. 源文件中有的函数可以内联

   ```cpp
   LLinearGradient::LLinearGradient(int x1, int y1, int x2, int y2)
       : LLinearGradient(LPoint(x1, y1), LPoint(x2, y2))
   {
   }
   
   LLinearGradient::~LLinearGradient()
   {
   }
   ```

## 菜单

### LMenu

### LMenuItem

# 学习的点

## 画笔

### LPen

我以为这个类是拿来做画笔的相关绘制的，但其实设计并非我想的这样。这个类`LPen`只是一个数据存储类，保存了画笔需要的一些信息，例如画笔宽度、画笔连接样式、画笔颜色等，真正管理绘画的类是绘画引擎类，对于`LPen`是`LDrawEngine`以及其下面的工具类，这些类里面保存了`LPen`对象，并且针对不同的绘画做了不同的处理，包括下面的画刷`LBrush`也是一样的道理

<img src="https://img-blog.csdnimg.cn/direct/81c0ae4e9f6d4684bc8d5c28bb60a5ac.png" alt="image-20240306104337531" style="zoom:85%;" />

## 画刷

### LBrush

### LLinearGradient

## 菜单

### LMenu

### LMenuItem

