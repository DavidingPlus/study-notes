---
title: 智能控制 期末复习
categories:
  - 校内课程
  - 智能控制
abbrlink: 4966c01c
date: 2023-11-29 15:25:15
updated: 2023-12-07 10:00:00
---

<meta name="referrer" content="no-referrer"/>

这门课以前是交通方向的选修的，但是到我们这一届就变成必修了。。。还要考试，还学不懂，头大。。。

考完了，复习到的都做出来了，没复习到的也自己分析尽量写满了，尽力就行！

# 第一章 计算机控制系统概述

- 计算机控制技术：把**计算机技术**和**自动化控制系统技术**融为一体

## 控制系统组成

### 控制系统概念

- 计算机控制系统：**常规仪表控制系统**演变而来

- 常规仪表控制系统：**闭环控制**，**开环控制**

<!-- more -->

  - 闭环控制系统：**按偏差进行控制**

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231122140302855.png" alt="image-20231122140302855" style="zoom:67%;" />

  - 开环控制系统：**按给定值直接进行控制**

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231122140315987.png" alt="image-20231122140315987" style="zoom:67%;" />

  - 计算机**闭环**控制系统：**把常规仪表闭环控制系统的控制器用计算机和`D/A`转换接口代替**

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231122140437329.png" alt="image-20231122140437329" style="zoom:67%;" />

  - 监控过程步骤：**实时数据采集，实时数据处理，实时输出控制**

### 硬件组成

- **主机**：`CPU`+`RAM`(随机存储器)+`ROM`(只读存储器)+系统总线

- **常规外部设备(外设)**：输入/输出设备 + 外存储器

- **过程输入输出通道**：`AI`，`AO`，`DI`，`DO`

- **操作台**：`CRT`，`LED`，`LCD`

- **通信设备**：交换机，`modem`，集线器

  图如下：

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231122141611445.png" alt="image-20231122141611445" style="zoom:67%;" />

### 软件组成

- 硬件仅为计算机控制系统的**躯体**
- **软件是完成各种功能的计算机程序的总和，是完成计算机控制系统的神经中枢，整个系统的动作都是在软件程序的指挥下协调工作的**
- 分类：**系统软件，应用软件**

## 控制系统分类

- 一个总的图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204142830507.png" alt="image-20231204142830507" style="zoom: 67%;" />

- **数据采集系统(`DAS`)**：**所有计算机控制系统的基础**

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231201161927415.png" alt="image-20231201161927415" style="zoom:67%;" />

- 操作指导控制系统(`OGC`)：基于数据采集系统的一种开环结构

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231201162018857.png" alt="image-20231201162018857" style="zoom:67%;" />

- 直接数字控制系统(`DDC`)：用一台计算机完成对多个被控参数的数据采集，且按一定的控制规律进行实时决策，并通过输出通道发出控制信号以实现对生产过程的闭环控制

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231201162046292.png" alt="image-20231201162046292" style="zoom:67%;" />

- 监督计算机控制系统(`SCC`)：`OGC`操作指导控制系统 与 常规仪表系统或与`DDC`直接数字控制系统综合而成的两级系统

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231201162159481.png" alt="image-20231201162159481" style="zoom:67%;" />

- 分散控制系统(`DCS`)：以微处理器为基础，借助于计算机网络对生产过程进行集中管理和分散控制的先进计算机控制系统

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231201162212109.png" alt="image-20231201162212109" style="zoom:67%;" />

- 现场总线控制系统(`FCS`)：一种全数字化、全分散式、可互操作的和全开放式的新型控制系统

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231201162229453.png" alt="image-20231201162229453" style="zoom:67%;" />

- 计算机集成制造系统(`CIMS`)：计算机技术、网络技术、自动化技术、信号处理技术、管理技术和系统工程技术等新技术发展的结果，它将企业的生产、经营、管理、计划、产品设计、加工制造、销售及服务等环节和人力、财力、设备等生产要素集成起来，进行统一控制，求得生产活动的最优化

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231201162240936.png" alt="image-20231201162240936" style="zoom:67%;" />

## 控制装置种类

- 一个总的图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204143347659.png" alt="image-20231204143347659" style="zoom:67%;" />

- 可编程控制器(`PLC`)

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231201162535360.png" alt="image-20231201162535360" style="zoom:67%;" />

- 可编程调节器

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231201162543567.png" alt="image-20231201162543567" style="zoom:67%;" />

- 总线式工控机

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231201162554855.png" alt="image-20231201162554855" style="zoom:67%;" />

- 嵌入式计算机系统

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231201162605130.png" alt="image-20231201162605130" style="zoom:67%;" />

- 其他控制装置：**分散控制系统与现场总线控制系统**

# 第二章 模拟量输出通道

## 引言

- 模拟量输出通道的**任务**：**把计算机处理后的数字量信号转换成模拟量电压或电流信号，去驱动相应的执行器，从而达到控制的目的**

- 模拟量输出通道(称为`D/A`通道或`AO`通道)**构成**：**一般是由接口电路、数/模转换器(简称`D/A`或`DAC`)和电压/电流变换器等构成**

- 核心：`D/A`**转换器**，所以模拟量输出通道又叫`D/A`通道

- 模拟量输出通道**基本构成**：**多`D/A`结构，共享`D/A`结构**

  多`D/A`结构：

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231122143856168.png" alt="image-20231122143856168" style="zoom:67%;" />

  共享`D/A`结构：

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231122143917400.png" alt="image-20231122143917400" style="zoom:67%;" />

## D/A转换器

### 工作原理与性能指标

#### 工作原理

图如下：

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231122144654634.png" alt="image-20231122144654634" style="zoom:67%;" />

- **转化过程公式推导(这个还是记一下吧)**

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231202171609447.png" alt="image-20231202171609447" style="zoom: 67%;" />

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231202171628834.png" alt="image-20231202171628834" style="zoom:67%;" />

#### 性能指标

- 分辨率：`D/A`**转换器能分辨的最小输出模拟增量，即当输入数字发生单位数码变化时所对应输出模拟量的变化量**。它取决于能转换的二进制位数，**数字量位数越多，分辨率也就越高，但是对应的分辨率的值越小，因为能分辨的增量变小了，肯定就代表精度越高了**

  公式如下，其中`n`代表这个`D/A`是多少位的

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231202171832325.png" alt="image-20231202171832325" style="zoom:67%;" />

- 转换精度：转换后所得的实际值和理论值的接近程度

- 偏移量误差：输入数字量时，输出模拟量对于零的偏移值

- 线性误差：是`D/A`转换器偏移理想转换特性的最大偏差与满量程之间的百分比

- 稳定时间：描述`D/A`转换速度快慢的一个参数，指**从输入数字量变化到输出模拟量达到终值误差**`1/2 LSB`**时所需的时间**，`LSB`**指输入二进制数的最低有效位**

### 8位DAC0832芯片

- 性能

  - 8位`D/A`转换器
  - **电流输出**方式
  - **稳定时间为`1μs`**
  - **采用`20`脚双立直插式封装**
  - 同系列芯片还有 `DAC0830`、`DAC0831`

- 工作原理

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129172219134.png" alt="image-20231129172219134" style="zoom:67%;" />

- 引脚功能

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129172242040.png" alt="image-20231129172242040" style="zoom:67%;" />

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129172252469.png" alt="image-20231129172252469" style="zoom:67%;" />

  - 当`WR2`和`XFER`同时有效时，8位`DAC`寄存器端为高电平`“1”`，此时`DAC`寄存器的输出端`Q`跟随输入端D也就是输入寄存器`Q`端的电平变化；反之，当端为低电平`“0”`时，第一级`8`位输入寄存器`Q`端的状态则锁存到第二级`8`位`DAC`寄存器中，以便第三级`8`位`DAC`转换器进行`D/A`转换
  - 一般情况下为了简化接口电路，可以把和直接接地，使第二级`8`位`DAC`寄存器的输入端到输出端直通，只有第一级8位输入寄存器置成可选通、可锁存的单缓冲输入方式。 特殊情况下可采用双缓冲输入方式，即把两个寄存器都分别接成受控方式

### 12位DAC1210芯片

- 性能

  - 是一个`12`位`D/A`转换器，**电流输出**方式，其结构原理与控制信号功能基本类似于`DAC0832`。由于它比`DAC0832`多了`4`条数据输入线，故有**`24`条引脚**

- 工作原理

  - **内部有`3`个寄存器**
    - 一个`8`位输入寄存器，用于存放`12`位数字量中的高`8`位`DI11~DI4`；一个`4`位输入寄存器，用于存放`12`位数字量中的低`4`位`DI3 ~DI0`
    - 一个`12`位`DAC`寄存器，存放上述两个输入寄存器送来的`12`位数字量
    - `12`位`D/A`转换器用于完成`12`位数字量的转换

- 原理图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129172717416.png" alt="image-20231129172717416" style="zoom:67%;" />

## 接口电路

- 接口电路的功能：**进行地址译码，产生片选信号或写信号**

### DAC0832接口电路

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129172920330.png" alt="image-20231129172920330" style="zoom:67%;" />

- `D/A`转换接口程序

  ~~~asm
  MOV  DX，220H   ;口地址如220H送入DX     
  MOV  AL，[DATA] ;被转换的数据如DATA送入累加器AL   
  OUT  DX，AL     ;送入D/A转换器进行转换
  ~~~

### DAC1210接口电路

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129173049042.png" alt="image-20231129173049042" style="zoom:67%;" />

- `D/A`转换接口程序

  ~~~asm
  DAC： MOV  DX，0381H  
        MOV  AL，[DATA]  
        OUT  DX，AL       ;送高8位数据
        DEC  DX
        MOV  AL，[DATA+1]
        OUT  DX，AL       ;送低4位数据
        MOV  DX，0384H
        OUT  DX，AL       ;完成12位数据转换
  ~~~

## 输出方式

- 分类：**电压输出，电流输出，自动/手动切换输出**等

### 电压输出

- 分类：**单极性输出，双极性输出**

- `DAC`单极性输出

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129173450562.png" alt="image-20231129173450562" style="zoom:67%;" />

- `DAC`双极性输出

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129173511218.png" alt="image-20231129173511218" style="zoom:67%;" />

  运算过程：

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129173523668.png" alt="image-20231129173523668" style="zoom:67%;" />

### 电流输出

- **电流信号易于远距离传送，且不易受干扰，特别是在过程控制系统中，自动化仪表只接收电流信号，所以在微机控制输出通道中常以电流信号来传送信息**，这就需要将电压信号再转换成电流信号，完成电流输出方式的电路称为`V/I`变换电路

- 两种形式：**普通运放`V/I`变换电路，集成转换器`V/I`变换电路**

- 普通运放`V/I`交换电路

  - `0~10mA`的输出

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129192125339.png" alt="image-20231129192125339" style="zoom:67%;" />

    分析

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129192149832.png" alt="image-20231129192149832" style="zoom:67%;" />

  - `4~20mA`的输出

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129192208487.png" alt="image-20231129192208487" style="zoom:67%;" />

    分析

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129192223213.png" alt="image-20231129192223213" style="zoom:67%;" />

- 集成转换器`V/I`变换电路

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129192342352.png" alt="image-20231129192342352" style="zoom:67%;" />

### 自动/手动输出方式

- 变换电路图：

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129192524739.png" alt="image-20231129192524739" style="zoom:67%;" />

- 自动/手动状态下的`V/I`变换

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129192603502.png" alt="image-20231129192603502" style="zoom:67%;" />

- 自动/手动双向无扰动切换

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129192630342.png" alt="image-20231129192630342" style="zoom:67%;" />

## D/A转换模板

### 通用性

- 体现在三个方面：**符合总线标准，接口地址可选，输出方式可选**

- 符合总线标准

  - 这里的**总线是指计算机内部的总线结构**，`D/A`转换模板及其它所有电路模板都应符合统一的总线标准，以便设计者在组合计算机控制系统硬件时, **只需往总线插槽上插上选用的功能模板而无需连线**，十分方便灵活。

- 接口地址可选

  - **一套控制系统往往需配置多块功能模板，或者同一种功能模板可能被组合在不同的系统中**

  - 因此，**每块模板应具有接口地址的可选性**

  - **一般接口地址可由基址(或称板址)和片址(或称口址)组成**

  - 接口地址可选的译码电路

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129192944988.png" alt="image-20231129192944988" style="zoom:67%;" />

- 输出方式可选

  - 为了适应不同控制系统对执行器的不同需求，D/A转换模板往往把各种电压输出和电流输出方式组合在一起，然后**通过短接柱来选定某一种输出方式**
  - 一个实际的`D/A`转换模板，供用户选择的输出范围常常是：`0~5V`、`0~10V`、`±5V`、`0~10mA`、`4~20mA`等

### 设计举例

#### 设计原则

- **安全可靠**：尽量选用性能好的元器件，并采用光电隔离技术
- **性价比高**：既要在性能上达到预定的技术指标，又要在技术路线、芯片元件上降低成本
- **通用性**：`D/A`转换模板应符合总线标准，其接口地 址及输出方式应具备可选性

#### 设计步骤

- 确定性能指标
- 设计电路原理图
- 设计和制造印制线路板
- 最后焊接和调试电路板

#### 8路8位D/A转换模板实例

- 设计老师说过不要求，这部分简单看一下就好了
- 电路原理图

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129194113042.png" alt="image-20231129194113042" style="zoom:67%;" />

- 分析

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129194149478.png" alt="image-20231129194149478" style="zoom:67%;" />

- 接口子程序设计

  设`8`路`D/A`转换的`8`个输出数据存放在内存数据段`BUF0~BUF7`单元中，主过程已装填`DS`，`8`片`DAC0832`的通道口地址为`38H~3FH`，分别存放在从`CH0`开始的`8`个连续单元中，该`D/A`转换模板的接口子程序为：

  ~~~asm
  DOUT   PROC  NEAR
  MOV  CX，8
  MOV  BX，OFFSET  BUF0
  NEXT： MOV  AL，[BX]
  OUT  CH0，AL
  INC  CH0
  INC  BX
  LOOP  NEXT
  RET
  DOUT  ENDP
  ~~~

# 第三章 模拟量输入通道

## 引言

- 任务：**把被控对象的过程参数如温度，压力，流量，液位，数量等模拟量信号转换为计算机可以接收的数字量信号(模拟量到数字量的转换)**

- 组成核心：`A/D`转换器

- **结构组成，各部分作用**：

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129200912376.png" alt="image-20231129200912376" style="zoom:67%;" />

## 传感变送器

- 作用：**将现场物理量转化为电信号**

## 信号调理电路

- 作用：**抑制干扰，保证`A/D`转换精度**
- 一般**采用电阻分压法把现场传送来的电流信号转换为电压信号**
- 分类：**无源`I/V`变换，有源`I/V`变换**

### 无源I/V变换

- 构成：无源器件电阻，RC滤波，二极管限幅等实现

- 取值：

  - 输入`0-10mA`，输出为`0-5V`，`R1=100Ω`，`R2=500Ω`
  - 输入`4-20mA`，输出为`1-5V`，`R1=100Ω`，`R2=250Ω`

- 电路图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129201237919.png" alt="image-20231129201237919" style="zoom:67%;" />

### 有源I/V变换

- 构成：运算放大器，电阻电容

- 电路放大倍数

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129201326029.png" alt="image-20231129201326029" style="zoom:67%;" />

- 取值

  - `R1=200Ω`，`R3=100kΩ`，`R4=150kΩ`，输入`0~10mA`输出`0~5V` 
  - `R1=200Ω`，`R3=100kΩ`，`R4=25kΩ`，输入`4~20mA`输出`1~5V`

- 电路图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129201429941.png" alt="image-20231129201429941" style="zoom:67%;" />

## 多路模拟开关

- 作用：**实现多选一**

- 结构原理

  - 组成：**电平转换、译码驱动，开关电路**

  - 原理图

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129201520507.png" alt="image-20231129201520507" style="zoom:67%;" />

- 扩展电路

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129201555935.png" alt="image-20231129201555935" style="zoom:67%;" />

## 前置放大器

- 作用：**将输入模拟小信号放大到`A/D`转换的量程范围** ，如`0V(DC)~5V(DC)`

- 分类：**测量放大器，可变增益放大器**

- 测量放大器

  - 特点：**对称结构，可抑制共模干扰**

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129201853465.png" alt="image-20231129201853465" style="zoom:67%;" />

- 可变增益放大器

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129201914425.png" alt="image-20231129201914425" style="zoom:67%;" />

## 采样保持器

- 作用：**保证，保持`A/D`精度**

### 数据采样定理

- 采样过程：**以一定的时间间隔对连续信号进行采样，使连续信号转化为时间上离散，幅值上连续的脉冲序列的过程**

- 周期采样：以**相同**的时间间隔进行采样

- **香农定理：为了能让采样信号能够完全复现原信号，采样信号的频率至少要为原信号最大频率的2倍**

- 周期采样过程

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129202043371.png" alt="image-20231129202043371" style="zoom:67%;" />

### 采样保持器

- **零阶采样保持器**

  - 构成：输入输出缓冲放大器`A1`、`A2`和采样开关`S`、保持电容`CH`

  - 工作过程

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129202152271.png" alt="image-20231129202152271" style="zoom:67%;" />

  - 结构图

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129202207870.png" alt="image-20231129202207870" style="zoom:67%;" />

- **零阶集成采样保持器**

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129202249975.png" alt="image-20231129202249975" style="zoom:67%;" />

## A/D转换器

### 工作原理与性能指标

#### 工作原理

- 分类：**逐位逼近式，双积分式，电压/频率式**等

- 逐位逼近式`A/D`转换原理

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231130093227911.png" alt="image-20231130093227911" style="zoom:67%;" />

  例题

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231130093246804.png" alt="image-20231130093246804" style="zoom:67%;" />

- 双积分式`A/D`转换原理

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231130093312475.png" alt="image-20231130093312475" style="zoom:67%;" />

- 电压/频率式`A/D`转换原理

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231130093347992.png" alt="image-20231130093347992" style="zoom:67%;" />

#### 性能指标

`A/D`转换器的性能指标

- 分辨率：**分辨率是指`A/D`转换器对微小输入信号变化的敏感程度。分辨率越高，转换时对输入量微小变化的反应越灵敏**(和`D/A`的那个同理)

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231130093531573.png" alt="image-20231130093531573" style="zoom:67%;" />

- 转换精度：用**绝对误差和相对误差**表示

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231130093821855.png" alt="image-20231130093821855" style="zoom:67%;" />

- 转换时间：**`A/D`转换器完成一次转换所需的时间称为转换时间**

  - 逐位逼近式`A/D`转换器的转换时间为**微秒级**，双积分式`A/D`转换器的转换时间为**毫秒级**

- 非线性误差：**`A/D`转换器实际转换特性曲线与理想特性曲线之间的最大偏差**

  - 一般要求非线性误差不大于`1/2LSB`。通常用非线性误差来表示`A/D`转换器的线性度

### 8位ADC0809芯片

#### 芯片介绍                                                                                                     

- `8`位逐位逼近式`A/D`转换器

- 分辨率为`1/ 2^8 ≈ 0.39 %`

- 模拟电压转换范围：`0 ~ +5 V`

- 标准转换时间：`100μs`

- 采用`28`脚双立直插式封装

- 内部结构

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231130094442688.png" alt="image-20231130094442688" style="zoom:67%;" />

- 内部转换时序

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231130094457632.png" alt="image-20231130094457632" style="zoom:67%;" />

#### 接口电路

- 解决：主机如何分时采集多路模拟量输入信号的，即主机如何启动`A/D`转换（体现为对`START`和`ALE`引脚的控制），如何判断`A/D`完成一次模数转换（体现为是否读取`EOC`标志，如何读取），如何读入并存放转换结果的
- 分类：**查询方式，定时方式**

##### 查询方式读A/D转换数

- 查询：非与门`02（3`）、`/IOW`控制`A/D`转换启动；通过三态缓冲器读入`EOC`状态以判断是否转换结束

- 结构图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231130094728435.png" alt="image-20231130094728435" style="zoom:67%;" />

- 接口程序

  ~~~asm
          MOV   BX , BUFF  ;置采样数据区首址
          MOV   CX , 08H   ;８路输入
  START： OUT   PA , AL       ;启动A/D转换
  REOC：  IN     AL , PB        ;读EOC
          RCR   AL , 01       ;判断EOC
          JNC   REOC          ;若EOC=0，继续查询
          IN     AL , PA        ;若EOC=1，读A/D转换数
          MOV  [BX] , AL   ;存A/D转换数
          INC    BX             ;存A/D转换数地址加1
          INC    PA             ;接口地址加1
          LOOP  START      ;循环
  ~~~

##### 定时方式读A/D转换数

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231130094905071.png" alt="image-20231130094905071" style="zoom:67%;" />

##### 共同点

- 硬软件接口简单，但在转换期间独占了`CPU`时间，好在这种逐位逼近式`A/D`转换的时间只在微秒数量级
- 当选用双积分式`A/D`转换器时，因其转换时间在毫秒级，因此采用中断法读`A/D`转换数的方式更为适宜
- 在设计数据采集系统时，究竟采用何种接口方式要根据`A/D`转换器芯片而定

### 12位AD574A芯片

#### 芯片介绍

- 一种高性能的`12`位逐位逼近式`A/D`转换器

- 分辨率：`1 / 2^12 = 0.024%` 

- 转换时间：`25μs`,适合于在**高精度快速采样系统**中使用

- 内部结构大体与`ADC0809`类似，由`12`位`A/D`转换器、控制逻辑、三态输出锁存缓冲器与`10V`基准电压源构成，可以直接与主机数据总线连接，但只能输入一路模拟量

- `AD574A`也采用`28`脚双立直插式封装

- 结构图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231130095635004.png" alt="image-20231130095635004" style="zoom:67%;" />

- 模拟输入信号的几种接法

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231130095659594.png" alt="image-20231130095659594" style="zoom:67%;" />

#### 接口电路

- `12`位`A/D`转换器`AD574A`与`PC`总线的接口有多种方式。既可以与`PC`总线的`16`位数据总线直接相连，构成简单的`12`位数据采集系统；也可以只占用`PC`总线的低`8`位数据总线，将转换后的`12`位数字量分两次读入主机，以节省硬件投入
- 在`A/D`转换器与`PC`总线之间的数据传送上也可以使用程序查询、软件定时或中断控制等多种方法。由于`AD574A`的转换速度很高，一般多采用查询或定时方式

## A/D转换模板

- 遵循`I/O`模板的通用性原则：**符合总线标准，接口地址可选，输入方式可选**
- 输入方式可选主要是指模板既可以接受**单端输入信号**也可以接受**双端差动输入信号**
- 结构组成
  - **`I/O`电气接口**：完成电平转换、滤波、隔离等信号调理作用
  - **`I/O`功能部分**：实现采样、放大、模/数转换等功能
  - **总线接口逻辑**：完成数据缓冲、地址译码等功能

# 第四章 数字量输入/输出通道

在微机控制系统中，除了需要处理模拟信号，还要处理数字信号，包括开关信号，脉冲信号等等。

## 光电耦合隔离技术

### 光电耦合隔离器

- 三种类型：**三极管型，单向可控硅型，双向可控硅型**

- 原理：通过电，光，电这种信号转换，利用**光信号的传送不受电磁场的干扰完成隔离功能**

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123102119091.png" alt="image-20231123102119091" style="zoom:67%;" />

### 光电耦合隔离电路

- **同相传递：输入输出同相，输入为低，输出为低**
- **反相传递：输入输出反相，输入为高，输出为低**
- 记忆：同相的两个电阻都在`+5V`的正极这一侧

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123102639789.png" alt="image-20231123102639789" style="zoom:67%;" />

## 数字量输入通道(DI)

- 生产过程中除了能产生模拟信号，当然也能直接产生数字信号，我们要关心的问题就是这个数字信号能不能被我们的计算机正确接收处理
- 任务：**把生产过程中的数字信号转换成计算机易于接受的形式**

- 信号调理电路：**虽然都是数字信号，不需进行`A/D`转换，但对通道中可能引入的各种干扰必须采取相应的技术措施，即在外部信号与单片机之间要设置输入信号调理电路**

### 开关输入电路

- 考虑：

  - 电平转换：用电阻分压法把电流信号转换为电压信号

  - `RC`滤波：用`RC`滤波器滤出高频干扰

  - 过电压保护：用稳压管和限流电阻作过电压保护；用稳压管或压敏电阻把瞬态尖峰电压箝位在安全电平上

  - 反电压保护：串联一个二极管防止反极性电压输入

  - 光电隔离：用光耦隔离器实现计算机与外部的完全电隔离

- 开关量输入信号调理电路

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123103850760.png" alt="image-20231123103850760" style="zoom:67%;" />

### 脉冲计数电路

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123104019996.png" alt="image-20231123104019996" style="zoom:67%;" />

## 数字量输出通道(DO)

- 任务：**把计算机输出的微弱数字信号转换成能对生产过程进行控制的数字驱动信号**
- 常用电路：**三极管，继电器，晶闸管，固态继电器驱动电路**等
- 选择：根据现场负荷的不同，如指示灯、继电器、接触器、电机、阀门等，可以选用不同的功率放大器件构成不同的开关量驱动输出通道

### 三极管驱动电路

- 分类：普通三极管驱动电路，达林顿驱动电路

#### 普通三极管驱动电路

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123104947847.png" alt="image-20231123104947847" style="zoom:67%;" />

#### 达林顿驱动电路

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123105124602.png" alt="image-20231123105124602" style="zoom:67%;" />

MC1416一路驱动电路

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123105224373.png" alt="image-20231123105224373" style="zoom: 67%;" />

### 继电器驱动电路

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123105300226.png" alt="image-20231123105300226" style="zoom:67%;" />

### 晶闸管驱动电路

- 分类：**单向晶闸管，双向晶闸管**
- 结构：**阳极A、阴极K、控制极（门极）G**(三个极)

### 固态继电器驱动电路

- **固态继电器SSR**（Solid State Relay）：是一种新型的无触点开关的电子继电器，它利用电子技术实现了控制回路与负载回路之间的电隔离和信号耦合，而且没有	任何可动部件或触点，却能实现电磁继电器的功能
- 优点：**体积小、开关速度快、无机械噪声、无抖动和回跳、寿命长**

固态继电器输出驱动电路

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123105658610.png" alt="image-20231123105658610" style="zoom:67%;" />

## DI/DO模板

**把数字量输入输出通道设计在一块模板上**，就称为`DI/DO`模板

- 结构组成(遇到了都这么写)：**`I/O`电气接口，`I/O`功能逻辑，总线接口逻辑**

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123105738964.png" alt="image-20231123105738964" style="zoom:67%;" />

# 第五章 键盘及其接口技术

## 引言

- 键盘
  - 常用的输入设备，是一组按键的集合
  - 通过功能分类：**数字键和功能键**
  - 作用：输入数据与命令，查询和控制系统的工作状态，实现简单的人机对话
- 键盘接口电路
  - 分类：**编码键盘和非编码键盘**
  - 编码键盘
    - 采用硬件编码电路来实现键的编码，每按下一个键，键盘便能自动产生**按键代码**。编码键盘主要有`BCD码`键盘、`ASCII`码键盘等类型
    - 特点：**使用方便，键盘码产生速度快，占用CPU时间少，但对按键的检测与消除抖动干扰是靠硬件电路来完成的，因而硬件电路复杂、成本高**
  - 非编码键盘
    - 仅提供按键的通或断状态，**按键代码**的产生与识别由软件完成
    - 特点：**硬件电路简单，成本低，但占用CPU的时间较长**

## 键盘输入电路

### 抖动干扰

- 定义：**由于机械触点的弹性振动，按键在按下时不会马上稳定的接通，在弹起时也不能一下完全的断开，从而会出现一连串的抖动，这种抖动就称为按键的抖动干扰**

### 抖动干扰的消除

- 硬件方法：**设计一个滤波延时电路或单稳态电路**
- 软件方法：**编制一段时间大于100ms的延时程序**

## 非编码独立式键盘

### 查询法接口电路

电路

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123111857176.png" alt="image-20231123111857176" style="zoom:67%;" />

流程图

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123111909659.png" alt="image-20231123111909659" style="zoom:67%;" />

过程

**开关`Si`闭合的时候，对应的`Di`=0；CPU查询检测是否有键按下，之后先消除抖动，然后判断键号，然后再转为对应的键功能程序**

### 中断法接口电路

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123112139191.png" alt="image-20231123112139191" style="zoom:67%;" />

## 非编码矩阵式键盘

### 结构组成

矩阵式键盘又叫行列式键盘，是用`I/O`口线组成的行、列矩阵结构，在每根行线与列线的交叉处，**二线不直接相通而通过一个 按键跨接 接通**。采用这种矩阵结构只需`M`根行输出线和`N`根列输入线，就可连接`M×N`个按键。通过键盘扫描程序的行输出与列输入就可确认按键的状态，再通过键盘处理程序便可识别键值。 

结构图

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123113312194.png" alt="image-20231123113312194" style="zoom:67%;" />

### 程序设计

关于设计的都不是很重要，所以也是了解即可。

- 必须考虑：**实时性，消除抖动干扰**
- 方式：**编程扫描，定时扫描和中断扫描**

## 编码键盘

### 二进制编码器

- 真值表

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123113616999.png" alt="image-20231123113616999" style="zoom:67%;" />

### 编码键盘接口电路

- 接口电路图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123113659234.png" alt="image-20231123113659234" style="zoom:67%;" />

- 消抖电路波形图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123113729301.png" alt="image-20231123113729301" style="zoom:67%;" />

# 第六章 显示器及其接口技术

## 引言

- 显示装置：用来显示生产过程的工艺状况与运行结果；也叫操作台(第一章)

常用的显示器件

- **显示记录仪**：以**模拟方式**连续显示和记录过程参数的动态变化，但其价格都很贵，在目前的计算机控制系统中已很少采用
- `LED`**数码管显示器**：具有**结构简单、体积小、功耗低、配置灵活、显示清晰、可靠性高**等优点，已被微型计算机控制系统及智能化仪表广泛采用
- `LCD`**液晶显示器**：以其**功耗极低**的特点，占据了从电子表到计算器，从袖珍仪表到便携式微型计算机等应用场合
- `CRT`**终端**：以其**图文并茂的直观生动画面**，可以显示生产过程中的各种画面及报表，如生产流程图、显示报警图、趋势曲线图、	       路查询图等,在很多微型计算机控制系统中，特别在`DDC`，`SCC`以及`DCS`控制系统中，大都采用`CRT`操作台进行监视和控制

## LED数码管显示器

### 工作原理

- `LED`：**利用`PN`结把电能转换成光能的固体发光器件**，根据制造材料的不同可以发出红、黄、绿、白等不同色彩的可见光来
- 伏安特性：类似普通二极管，正向压降约为`2`伏左右，工作电流一般在`10-20mA`
- 结构特性：单段的圆形或方形`LED`常用来显示设备的运行状态，`8`段`LED`可以显示各种数字和字符

### 8段LED显示器

#### 结构与工作原理

- **共阴极：阴极并接成为公共端`COM`，加高电平灯亮**(共阴极加的是高电平，这个记住了，共阳相反)

- **共阳极：阳极并接成为公共端`COM`，加低电平灯亮**

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123143020757.png" alt="image-20231123143020757" style="zoom:67%;" />

#### 选码原理

- 点亮`8`段`LED`不同段的组合，就可以显示十六进制数

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123143230868.png" alt="image-20231123143230868" style="zoom:67%;" />

### LED显示器显示方式

- `n`个`LED`显示器构成`n`位显示
- 位选和片选：**把点亮`LED`某一段的控制称为段选，而把点亮`LED`数字某一位的控制称为位选或片选**

#### 静态显示

- 结构特点
  - **无位选，4个`COM`端连接在一起并接有效电平**
  - **段选独立，每个`LED`的段选各自与一个8位的并行`I/O`相连**
- 工作特点
  - **优点：占用`CPU`机时少，显示稳定可靠**
  - **缺点：电路中占用`I/O`口资源多**
- 适用：**规模较大的实时控制系统**

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123143606574.png" alt="image-20231123143606574" style="zoom:67%;" />

#### 动态显示

- 结构特点
  - **4个LED显示器各自的段选线连在一起，与一个8位的I/O口相连**
  - **各自的COM端则由另一个I/O口进行位选**
- 工作特点
  - **优点：占用I/O资源少**
  - **缺点：需用软件程序不断地循环扫描定时刷新，因而占用了CPU的大多数机时**
- 适用：**小型测控系统**

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123144933894.png" alt="image-20231123144933894" style="zoom:67%;" />

### LED显示器接口电路

- 正常工作必须有：**显示部分、锁存器、译码、驱动电路**

#### 静态显示接口电路

- **锁存，驱动，译码均由硬件实现**(`CD4511B)`

- 实现过程：`74LS138`输出作为`LED`片选，每两个共用一个片选；每两个段选码共用一个字节

- 接口电路

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123145649205.png" alt="image-20231123145649205" style="zoom:67%;" />

#### 动态显示接口电路

- **锁存，驱动由硬件实现**

- **译码由软件实现**

- 实现过程

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123145933065.png" alt="image-20231123145933065" style="zoom:67%;" />

- 接口电路

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123150002173.png" alt="image-20231123150002173" style="zoom:67%;" />

## LCD液晶显示器

### 引言

-  一种利用液晶的扭曲/向列效应制成的新型显示器
-  特点：**功耗极低、体积小、抗干扰能力强、价格廉价**等
-  分类：**字符式、段位式和点阵式**

### LCD显示器驱动方式

- **直接驱动(静态驱动)**：显示器件只有一个背极（即下玻璃电极基板），但每个字符段都有独立的引脚

- **多极驱动(时分割驱动)**：显示器具有多个背极，各字符段按点阵结构排列，这是显示字段较多时常采用的驱动方式

- 工作过程

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123150810238.png" alt="image-20231123150810238" style="zoom:67%;" />

- 段位式7段`LCD`的电极配置及译码驱动电路

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123150825707.png" alt="image-20231123150825707" style="zoom:67%;" />

### 段位式LCD接口电路

- 硬件电路

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123150746085.png" alt="image-20231123150746085" style="zoom:67%;" />

### 点阵式LCD接口电路

- 引言

  - **点阵式`LCD`不但可以显示字符，而且可以显示各种图形及汉字**

  - **液晶显示模块**`12864`


- 液晶模块接线原理

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123151215905.png" alt="image-20231123151215905" style="zoom:67%;" />

- 液晶模块指令说明

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123151237866.png" alt="image-20231123151237866" style="zoom:67%;" />

- 软件初始化

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123151300918.png" alt="image-20231123151300918" style="zoom:67%;" />

- 应用举例

  液晶字符显示使用的时候注意：

  - 要在某一个位置显示中文字符时，应先设定显示字符位置，即先设定显示地址，再写入中文字符编码
  - 显示`ASCII`字符过程与显示中文字符过程相同。不过在显示连续字符时，只须设定一次显示地址，由模块自动对地址加`1`指向下一个字符位置，否则，显示的字符中将会有一个空`ASCII`字符位置
  - 当字符编码为`2`字节时，应先写入高位字节，再写入低位字节


## 图形显示器

### 概述

- 分类：**`CRT`显示器和`TFT`平面显示器**
- `CRT`显示器
  - 由一个图形监示器和相应的控制电路组成。在工业计算机中，插入一块`VGA/TVGA`图形控制板即可实现功能很强的图象显示功能
  - 优点：丰富的画图命令，如点、线、矩形、多边形、圆、弧以及区域填充、拷贝、剪裁等操作还有窗口功能等
  - 缺点：体积与功耗大，易受振动和冲击，容易受射线辐射、磁场干扰，因此在恶劣工况下须采用特殊加固和屏蔽措施
- `TFT`平面显示器
  - 体积小，耗电省，如最薄的壁挂式机型厚度仅为`5cm`(`2in`)
  - 可靠性高，寿命长，不易受振动、冲击和射线的干扰影响
  - 显示颜色`256`种基色，可扩展至`25600`种组合

### 图形显示界面

- 作用：直观形象地监视和操作工业生产过程

- 显示画面功能：反映出整个生产的工艺流程，便于单元操作控制；要有实时动态数据，又要有历史记忆功能

- 显示画面功能内容：调节器、指示仪、记录仪、报警仪、模拟屏以及开关按钮、指示灯等

- 设计语言：早期用汇编语言来编写，后来多采用高级语言，现在采用组态软件

- 常用的显示画面：**总貌画面、分组画面、点画面、流程图画面、趋势曲线画面、报警显示画面、操作指导画面**等

  - 总貌画面

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204154704178.png" alt="image-20231204154704178" style="zoom:67%;" />

  - 分组画面

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204154717595.png" alt="image-20231204154717595" style="zoom:67%;" />

  - 点画面

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204154732226.png" alt="image-20231204154732226" style="zoom:67%;" />

  - 流程图画面

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204154745173.png" alt="image-20231204154745173" style="zoom:67%;" />

  - 趋势曲线画面

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204154801510.png" alt="image-20231204154801510" style="zoom:67%;" />

  - 报警显示画面

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204154816038.png" alt="image-20231204154816038" style="zoom:67%;" />

  - 操作指导画面

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204154832060.png" alt="image-20231204154832060" style="zoom:67%;" />


# 第七章 数据处理技术

## 引言

- 数据采集：**在计算机控制系统中，数据采集是最基本的一种模式**。一般是通过传感器、变送器把生产过程的各种物理参数转换成电信号，然后经`A/D`通道或`DI`通道，把数字量送入计算机中
- 数据处理：计算机在对这些数字量进行显示和控制之前，还必须根据需要进行相应的数值计算即数据处理。为了满足不同系统的需要，设计出了许多有效的数据处理技术方法，如**预处理，数字滤波，标度变换，查表，越限报警**等

## 预处理技术

- 技术：**数字调零，系统校准，输入和输出数据的极性，字长的预处理技术**

### 系统误差的自动校准

- 系统误差：在控制系统的测量输入通道中，一般均存在**放大器等器件的零点偏移和漂移**，会造成**放大电路的增益误差及器件参数的不稳定**等现象
- 特点：在一定的测量条件下，其变化规律是可以掌握的，产生误差的原因一般也是知道的
- 处理方法：通过适当的技术方法如**数字调零、系统校准**来确定并加以校正的，一般采用**软件程序**进行处理

#### 数字调零

- **处理由零点偏移造成的系统误差，通过软件进行实现**
- 原理：`CPU`分时巡回采集`1`路至`n`路电压信号
- 特点：**可去掉放大电路、`A/D`转换电路本身的偏移及随时间与温度而发生的各种漂移的影响，从而大大降低对这些电路器件的偏移值的要求，降低硬件成本**
- 缺点：**不能校正由传感器本身引入的误差**

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231123153657445.png" alt="image-20231123153657445" style="zoom:67%;" />

#### 系统校准

- 原因：**克服传感器本身引入的误差**

- 系统校准计算

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231124111008876.png" alt="image-20231124111008876" style="zoom:67%;" />

- 适用场合：**传感器特性随时间会发生变化的场合**

### 数据字长的预处理

- 输入位数大于输出位数：**忽略高位数的最低几位**
- 输入位数小于输出位数：**将`8`位数左移两位构成`10`位数，最低两位用`0`填充**

## 数字滤波方法

- 定义：**计算机系统对输入信号采样多次，然后用某种计算方法进行数字处理，以削弱或滤除干扰噪声造成的随机误差，从而获得一个真实信号的过程**

- 分类：**平均值滤波，中值滤波，限幅滤波，惯性滤波**

### 平均值滤波

- 分类：**算术平均，去极值平均，加权平均，滑动平均**

- 适用场合：工业场合经常遇到的**尖脉冲干扰**的信号滤波

- 缺点：**灵敏度和平滑度较差**

- **算术平均值滤波**

  - 在采样周期`T`内，对测量信号`y`进行`m`次采样， 把`m`个采样值相加后的算术平均值作为本次的有效采样值

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231124114239824.png" alt="image-20231124114239824" style="zoom:67%;" />

- **去极值平均滤波**

  - 对连续采样的`m`个数据去掉其中的最大值与最小值，然后计算余下的`m-2`个数据的算术平均值

- **加权平均滤波**

  - 对每次采样值不以相同的权系数而以增加新鲜采样值的权重相加

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127143151675.png" alt="image-20231127143151675" style="zoom: 80%;" />

  - 关于加权系数`Ci`

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127143255796.png" alt="image-20231127143255796" style="zoom:67%;" />

  - 例子

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127143429294.png" alt="image-20231127143429294" style="zoom:80%;" />

- **滑动平均滤波**

  - 适用场合：前三种的平均滤波算法有一个共同点，每取得一个有效采样值必须连续进行若干次采样。系统的采样速度较慢或采样信号变化较快时，系统的实时性就无法得到保证
  - 滑动平均滤波：**在每个采样周期只采样一次，将这一次采样值和过去的若干次采样值一起求平均**，所得结果即为有效采样值
  - 滑动平均滤波算法优势：**实时性好，提高了系统的响应速度**


### 中值滤波

- 定义：**将信号`y`的连续`m`次采样值按大小进行排序，取其中间值作为本次的有效采样值**。本算法为取中值，故采样次数`m`应为奇数，一般`3~5`次即可
- 编制算法程序：将数据进行排序(随便选一个排序算法，例如冒泡，快排，归并等)，然后取中点
- 适用场合：**对 缓变过程中的偶然因素引起的波动 或 采样器不稳定造成的误差所引起的脉动干扰 比较有效，而对快速变化过程(如流量)的信号采样则不适用**

### 限幅滤波

- 定义：如下

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127144102345.png" alt="image-20231127144102345" style="zoom:67%;" />

- 适用场合：**对随机干扰或采样器不稳定引起的失真有良好的滤波效果**

### 惯性滤波

- 定义：**模拟硬件`RC`低通滤波器的数字实现**

- 传递函数：

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127144501882.png" alt="image-20231127144501882" style="zoom:80%;" />

- 实现方法：由于高精度的`RC`电路不易制作，所以硬件`RC`滤波器不可能对极低频率的信号进行滤波。为此，用软件做成低通数字滤波器，从而实现一阶惯性的数字滤波

## 标度变换算法

### 概述

- 标度：衡量某种物理量或参数的量纲
- 变换：从一种物理量转换为另一种物理量
- 标度变换：**把计算机系统检测的对象参数的二进制数值还原变换为原物理量的工程实际值**
- 标度变换方法：**线性式变换，非线性式变换，多项式变换，查表法**
- 方法选择依据：被测参数的工程量与转换后数字量间的函数关系；通常传感器的输入输出特性决定了此函数关系，从而决定标度变换方法

### 线性式变换

- 线性标度变换：**最常用的标度变换方式**

- 前提条件：传感器输出信号和被测参数之间呈线性关系

- 线式标度变换子程序举例

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127145319214.png" alt="image-20231127145319214" style="zoom:67%;" />

### 非线性式变换

- 条件：传感器的输出信号与被测参数之间呈非线性关系，**但函数关系可用解析式来表示**

- 非线式标度变换子程序举例

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127150344997.png" alt="image-20231127150344997" style="zoom:67%;" />

### 多项式变换

- 适用场合：传感器输出信号与被测参数间呈非线性关系

- 应用条件：非线性函数关系不可用解析式来表示

- 采用方法：**插值多项式**来进行标度变换

  - 插值多项式：用一个`n`次多项式来代替某种非线性关系

  - 插值原理：见下图(**我们不知道解析式，因此用多项式来代替，然后用数据带入进行拟合**)

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127151336148.png" alt="image-20231127151336148" style="zoom:80%;" />

    过程就是这样

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127151516823.png" alt="image-20231127151516823" style="zoom:67%;" />

  - 插值法缺点

    - 逼近精度影响：很大影响

      处理方法：通常在函数`y= f( x )`的曲线上曲率大的地方应适当加密插值点

    - `CPU`影响：增加插值点和多项式的次数能提高逼近精度但同时会增加计算时间

    - 较好的方法：使用**分段插值法**

      - 分段插值法

        **用多段折线代替曲线进行计算**

        <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127152318278.png" alt="image-20231127152318278" style="zoom:67%;" />

## 查表法

- 定义：**就是把事先计算或测得的数据按照一定顺序编制成表格**

- 任务：根据被测参数的值或者中间结果，查出最终所需要的结果

- 具体的查表方法：**顺序查表法，计算查表法，对分搜索法**等

  - 顺序查表法

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127152615113.png" alt="image-20231127152615113" style="zoom:67%;" />

  - 计算查表法

    要求：一定要能够通过一定的计算得出存储单元的地址，然后通过地址访问到数据

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127152633545.png" alt="image-20231127152633545" style="zoom:67%;" />

  - 对分查表法

    这不就是二分吗，秒了。。。

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127152649719.png" alt="image-20231127152649719" style="zoom:67%;" />

## 越限报警处理

### 越限报警程序

- 分类：上限报警，下限报警，上下限报警

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127153110730.png" alt="image-20231127153110730" style="zoom:80%;" />

- 具体设计报警程序时，**为了避免测量值在极限值一点处来回摆动造成频繁报警，一般应在极限值附近设置一个 回差带**

  例如，在下图中上下限其实是一个范围，就是回差带，为了避免频繁报警

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231127153152933.png" alt="image-20231127153152933" style="zoom:67%;" />

### 越限报警方式

- 分类：**普通声光报警，模拟声光报警，语音报警**

# 第八章 抗干扰技术

## 引言

- **干扰**：有用信号以外的噪声，这些干扰会影响系统的测控精度，降低系统的可靠性，甚至导致系统的运行混乱，造成生产事故
- 但是干扰是客观存在的，所以必须要研究干扰，以采取相应的抗干扰措施

## 干扰的来源和传播途径

### 来源

- **外部干扰**：例如天电干扰，天体干扰，电器设备的干扰，来自**电源的工频干扰**等等
- **内部干扰**：由**系统的结构布局、制造工艺**所引入的

### 干扰的传播途径

- 途径：**静电耦合，磁场耦合，公共阻抗耦合**
  - 静电耦合：电场通过电容耦合途径窜入其他线路
  - 磁场耦合：通过导体间的互感耦合进来的
  - 公共阻抗耦合：发生在两个电路的电流流经一个公共阻抗的时候，一个电路在该阻抗上的电压会影响到另一个电路，从而产生干扰噪声的影响


## 硬件抗干扰措施

- 除了按照干扰的三种主要作用方式——**串模，共模，长线传输**来分别考虑外，还要从布线、电源、接地等方面考虑

### 串模干扰的抑制

- 抑制措施：**双绞线做信号引线，引入滤波电路**

- 表现形式和产生原因

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129144328532.png" alt="image-20231129144328532" style="zoom:67%;" />

#### 双绞线做信号引线

- 双绞线抗干扰原因：**外界电磁场会在双绞线相邻的小环路上形成相反方向的感应电动势，从而互相抵消减弱干扰作用**

- 应用场合：**可用来传输模拟信号和数字信号，用于点对点连接和多点连接应用场合，传输距离为几公里，数据传输速率可达2Mbps**

- 抑制效果：**节距越小，干扰的衰减比越大，抑制干扰的屏蔽效果越好**

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129144720960.png" alt="image-20231129144720960" style="zoom: 80%;" />

#### 引入滤波电路

- 硬件滤波器分类：**低通、高通、带通**等滤波器

- 低通滤波器：**干扰频率比被测信号频率高**(干扰频率高了，我们只放低的，高的进不来)

- 高通滤波器：干扰频率比被测信号频率低

- **带通**滤波器：干扰频率落在被测信号频率的**两侧**

- 实现电路：采用电阻`R`、电容`C`、电感`L`等构成滤波器(具体的上高中的时候学物竞的时候我会，但是现在不会了。。。)

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129145815942.png" alt="image-20231129145815942" style="zoom:67%;" />

### 共模干扰的抑制

- 抑制方法：**变压器隔离，光电隔离，浮地屏蔽**等

#### 变压器隔离

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129145452377.png" alt="image-20231129145452377" style="zoom:67%;" />

#### 光电隔离

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129145524666.png" alt="image-20231129145524666" style="zoom:67%;" />

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129145543082.png" alt="image-20231129145543082" style="zoom:80%;" />

#### 浮地屏蔽

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129145609624.png" alt="image-20231129145609624" style="zoom:67%;" />

### 长线传输干扰的抑制

#### 波阻抗的测量

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129145701639.png" alt="image-20231129145701639" style="zoom:67%;" />

#### 终端阻抗匹配

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129145716676.png" alt="image-20231129145716676" style="zoom:67%;" />

#### 始端阻抗匹配

<img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129145734525.png" alt="image-20231129145734525" style="zoom: 80%;" />

### 信号线的选择和铺设

#### 信号线的选择

| 屏蔽结构            | **干扰衰减比** | 屏蔽效果/dB | **备注**                           |
| ------------------- | -------------- | ----------- | ---------------------------------- |
| 铜网（密度85%）     | 103：1         | 40.3        | **电缆的可挠性好，适合近距离使用** |
| 铜带迭卷（密度90%） | 376：1         | 51.5        | **带有焊药，易接地，通用性好**     |
| 铝聚酯树脂带迭卷    | 6610：1        | 76.4        | **应使用电缆沟，抗干扰效果最好**   |

#### 信号线的铺设

注意一下事项：

- **模拟信号线与数字信号线不能合用同一根电缆，要绝对避免信号线与电源线合用同一根电缆**
- **屏蔽信号线的屏蔽层要一端接地，避免多点接地**
- **信号线的敷设要尽量远离干扰源**，如避免敷设在大容量变压器、电动机等电器设备的附近
- **信号电缆与电源电缆必须分开，尽量避免平行敷设**

### 电源系统的抗干扰

- 计算机控制系统一般是由**交流电网**供电，电网电压与频率的波动将直接影响到控制系统的可靠性与稳定性
- **电源的干扰(外部干扰)**是计算机控制系统的一个主要干扰

#### 交流电源系统

- 选用**供电比较稳定**的进线**电源**

- 利用**干扰抑制器**消除尖峰干扰

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129150519032.png" alt="image-20231129150519032" style="zoom:80%;" />

- 采用**交流稳压器**稳定电网电压

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129150538346.png" alt="image-20231129150538346" style="zoom:80%;" />

- 利用**不间断电源**(`UPS`)保证不间断供电

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129150547176.png" alt="image-20231129150547176" style="zoom: 67%;" />

- **掉电保护电路**

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129150601888.png" alt="image-20231129150601888" style="zoom:67%;" />

#### 直流电源系统

- **交流电源变压器**的屏蔽

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129150635014.png" alt="image-20231129150635014" style="zoom:67%;" />

- 采用**直流电源开关**

- 采用`DC-DC`变换器

- 为每块电路板设置**独立的直流电源**

- 集成电路块的`Vcc`加**旁路电容**

### 接地系统的抗干扰

- 地线：**模拟地，数字地，信号地，系统地，交流地，保护地**

#### 接地处理

- 单点接地与多点接地

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129150938513.png" alt="image-20231129150938513" style="zoom:67%;" />

- 分别回流法单点接地

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129150956223.png" alt="image-20231129150956223" style="zoom:67%;" />

- 输入系统的接地

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129151009602.png" alt="image-20231129151009602" style="zoom:67%;" />

  放大器公共端接屏蔽罩

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129151043936.png" alt="image-20231129151043936" style="zoom:67%;" />

- 印制线路板的地线分布

  设计印制线路板应遵守下列原则，以免系统内部地线产生干扰。

  - `TTL`，`CMOS`器件的地线要呈辐射状，不能形成环形
  - 印制线路板上的地线要根据通过的电流大小决定其宽度，不要小于`3mm`，在可能的情况下，地线越宽越好
  - 旁路电容的地线不能长，应尽量缩短
  - 大电流的零电位地线应尽量宽，而且必须和小信号的地分开

- 主机系统的接地

  - 全机一点接地

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129151215969.png" alt="image-20231129151215969" style="zoom:67%;" />

  - 外壳接地机芯浮空

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129151231604.png" alt="image-20231129151231604" style="zoom:67%;" />

  - 多机系统的接地

## 软件抗干扰措施

- **采用数字滤波方法，即采用某种计算方法对通道的信号进行数字处理，以削弱或滤除干扰噪声**
- **对于那些可能穿过通道而进入CPU的干扰，可采取指令冗余、软件陷阱，程序运行监视(watchdog timer)等措施来使CPU恢复正常工作**

### 指令冗余

- 解决的问题：**程序跑飞**
- 解决方法：指令冗余技术
- 原则：在对程序流向起决定作用的指令之前以及影响系统工作状态的重要指令之前都应插入两、三条**空操作**`NOP`指令，还可以每隔一定数目的指令插入`NOP`指令，以保证跑飞的程序迅速纳入正确轨道
- 优点：**指令冗余技术可以减少程序出现错误跳转的次数**

### 软件陷阱技术

- 原则：在非程序区设置拦截措施，使程序进入陷阱，即通过一条引导指令，强行将跑飞的程序引向一个指定的地址

- 举例：

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129151700051.png" alt="image-20231129151700051" style="zoom:67%;" />

### 程序运行监视系统

- `Watchdog Timer`工作原理

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129151846909.png" alt="image-20231129151846909" style="zoom:67%;" />

- `Watchdog Timer`实现方法

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231129151906274.png" alt="image-20231129151906274" style="zoom:67%;" />

  

# 第九章 数字控制器的设计

- `9.1`是各种数学变换，不会也不考，不在这里罗列了
- 后面的内容也是了解即可，感觉不会是重点，因为没怎么讲，考了都做不起

## 数字控制器的离散化设计

### 数字控制器的连续设计步骤

- 设计思想：**将整个系统看作模拟系统，设计模拟控制器后再进行控制器的离散化**

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204194108279.png" alt="image-20231204194108279" style="zoom:67%;" />

- 设计步骤

  - 设计假象的连续控制器`D(s)`

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204194149589.png" alt="image-20231204194149589" style="zoom:67%;" />

  - 将`D(s)`离散化为`D(z)`

    - **离散化方法：双线性变换法，差分变化法**

      <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204194241333.png" alt="image-20231204194241333" style="zoom:67%;" />

  - 设计由计算机实现的控制算法

    <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204194258642.png" alt="image-20231204194258642" style="zoom:67%;" />

  - 校验

    需按闭环系统性能进行校验,可采用数字仿真方法验证

### PID控制规律

- `PID`控制：**对偏差信号按比例、积分、微分的函数关系进行运算，其运算结果用以输出控制**

- 原理图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204194410015.png" alt="image-20231204194410015" style="zoom:67%;" />

- 控制方法：**比例控制，积分控制，微分控制，比例积分微分控制**

#### 比例控制

- 效果：立即减少偏差

- 优点：调节及时

- 缺点：系统存在余差

- 图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204194509564.png" alt="image-20231204194509564" style="zoom:67%;" />

#### 积分控制

- 效果：消除余差

- 图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204194521786.png" alt="image-20231204194521786" style="zoom:67%;" />

#### 微分控制

- 效果：具有超前控制作用

- 图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204194641330.png" alt="image-20231204194641330" style="zoom:67%;" />

#### 比例积分微分控制

- 图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204194707878.png" alt="image-20231204194707878" style="zoom:67%;" />

#### 优点总结

- 文字懒得打了，就放图吧

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204194743204.png" alt="image-20231204194743204" style="zoom:67%;" />

### 基本数字PID控制算法

- **当采样周期足够短时，用求和代替积分、后向差分代替微分**，就可以使模拟PID离散为数字PID控制算法

- 公式图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204194856028.png" alt="image-20231204194856028" style="zoom:67%;" />

#### 数字PID位置型控制算法

- 图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204194941313.png" alt="image-20231204194941313" style="zoom:67%;" />

#### 数字PID增量型控制算法

- 图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195004090.png" alt="image-20231204195004090" style="zoom:67%;" />

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195039305.png" alt="image-20231204195039305" style="zoom:67%;" />

#### 数字PID控制算法实现比较

- 图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195110215.png" alt="image-20231204195110215" style="zoom:67%;" />

- 增量型和控制型比较，具有如下图的优点：

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195145142.png" alt="image-20231204195145142" style="zoom:67%;" />

#### 数字PID控制算法流程

- 图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195207234.png" alt="image-20231204195207234" style="zoom:67%;" />

### 数字PID算法的改进

- 几种改进算法：**积分分离算法，抗积分饱和算法，不完全微分PID控制算法，微分先行PID控制算法，带死区的算法**

#### 积分分离算法

- 现象：一般的`PID`,当有较大的扰动或大幅度改变设定值时，由于短时间内大的偏差，加上系统本身具有的惯性和滞后，在积分的作用下，将引出现起系统过量的超调和长时间的波动

- 作用：在控制的后期消除稳态偏差

- 分离措施

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195341795.png" alt="image-20231204195341795" style="zoom:67%;" />

- 普通分离算法：大偏差时不积分——积分“开关”控制

- 积分分离值的确定原则

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195408961.png" alt="image-20231204195408961" style="zoom:67%;" />

- 变速积分

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195424161.png" alt="image-20231204195424161" style="zoom:67%;" />

#### 抗积分饱和措施

- 抗积分饱和算法：当控制输出达到系统的上下限幅值的时候，停止积分

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195518787.png" alt="image-20231204195518787" style="zoom:67%;" />

- 串级控制系统抗积分饱和:主调节器抗积分饱和根据副调节器输出是否越限

#### 抗积分饱和与积分分离的对比

- 相同：某种状态下，切除积分作用
- 不同
  - 积分分离根据偏差是否超出预设的分离值(大偏差时不积分)
  - 抗积分饱和根据最后的控制输出是否越限(输出超限时不积分）

#### 不完全微分PID控制算法

- 问题引出

  - 对有高频扰动的生产过程，微分作用响应过于敏感，易引起振荡，降低调节品质
  - 执行需要时间，而微分输出短暂，结果是执行器短时间内达不到应有开度，使输出失真

- 解决：在输出端串联一阶惯性环节，组成不完全微分`PID`控制器

- 图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195715550.png" alt="image-20231204195715550" style="zoom:67%;" />

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195728960.png" alt="image-20231204195728960" style="zoom:67%;" />

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195741784.png" alt="image-20231204195741784" style="zoom:67%;" />

#### 微分先行PID控制算法

- 问题引出：给定值的升降会给控制系统带来冲击，如超调量过大，调节阀动作剧烈

- 解决：采用微分先行的`PID`控制算法

- 图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204195841886.png" alt="image-20231204195841886" style="zoom:67%;" />

- 微分先行PID控制算法和基本PID控制的不同之处：只对被控量（测量值）`y(t)`微分，不对偏差`e(t)`微分，也就是说对给定值`r(t)`无微分作用

- 适用于：给定值频繁升降的控制系统

#### 带死区的算法

- 图

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204200042493.png" alt="image-20231204200042493" style="zoom:67%;" />

- 注意：死区是一个非线性环节，不能象线性环节一样随便移到`PID`控制器的后面

### 数字PID参数的整定

- 一些方法
  - 理论整定方法：以被控对象的数学模型为基础，通过理论计算如根轨迹、频率特性等方法直接求得控制器参数
  - 工程整定方法：近似的经验方法，不依赖模型
  - 扩充临界比例带法，扩充响应曲线法，试凑法
- 数字控制器与模拟控制器相比，除了需要整定PID参数，即比例系数、积分时间和微分时间外，还有一个重要参数——采样周期

#### 采样周期的确定

- 影响采样周期选择的因素主要有： 对象的动态特性、扰动的特性、控制算法、执行机构的速度跟踪性能的要求

- 经验数据

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204200256667.png" alt="image-20231204200256667" style="zoom:67%;" />

#### 扩充临界比例法

- 模拟调节器中使用的临界比例带法（也称稳定边界法）的扩充，是一种闭环整定的实验经验方法
- 步骤
  - 选择一个足够短的采样周期`Tmin`
  - 找临界状态的参数
  - 选定控制度
  - 查表，求得`T，Kp，Ti，Td`的值
  - 按参数投入运行，做调整

#### 扩充响应曲线法

- 采用扩充响应曲线法进行数字PID的整定

- 步骤

  - 断开数字控制器，使系统在手动状态下工作。将被控量调节到给定值附近，当达到平衡时，突然改变手操值，相当给对象施加一个阶跃输入信号
  - 记录被控量在此阶跃作用下的变化过程曲线（即广义对象的飞升特性曲线
  - 根据飞升特性曲线，求得被控对象纯滞后时间    和等效惯性时间常数    。据此求得数字PID的整定参数的             值，按参数投入在投运观察控制效果

- 飞升特性曲线

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204200502410.png" alt="image-20231204200502410" style="zoom: 80%;" />

#### 试凑法

- 通过模拟或实际的系统璧还运行情况，观察系统的响应曲线，根据各参数对系统响应的大致影响，反复试凑，直至达到满意的目标

- 步骤

  - 整定比例部分（`纯P`作用）
  - 加入积分环节（`PI`作用）
  - 加入微分环节（`PID`作用）

- `PID`参数对系统性能影响

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204200605439.png" alt="image-20231204200605439" style="zoom:67%;" />

#### 仿真寻优法

- 运用仿真工具，或离散化后编程仿真

- 寻优方法：单纯形法、梯度法等

- 常见积分型性能指标

  <img src="https://image.davidingplus.cn/images/2025/02/02/image-20231204200644373.png" alt="image-20231204200644373" style="zoom:67%;" />

